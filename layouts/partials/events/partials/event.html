{{ $event := .event }}
{{ $layout := .layout | default "list" }}
{{ $heading_level := .heading_level | default 3 }}
{{ $is_sub_event := .is_sub_event }}
{{ $is_sup_event := .is_sup_event }}
{{ $with_more := .with_more }}

{{ $heading_tag := (dict 
    "open" ((printf "<h%d itemprop='name' class='event-title'>" $heading_level) | safeHTML)
    "close" ((printf "</h%d>" $heading_level) | safeHTML)
    ) }}
{{ $index := .index }}
{{ $alternate := .alternate }}
{{ $options := .options }}

{{ with $event }}
  {{ $class := "event" }}
  {{ if and .Params.image $options.image }}
    {{ $class = printf "%s event--with-image" $class }}
  {{ end -}}
  {{ if .Params.children }}
    {{ $class = printf "%s event--parent" $class }}
  {{ end -}}
  {{ if .Params.parent }}
    {{ $class = printf "%s event--child" $class }}
  {{ end -}}
  {{ $dates := .Params.dates }}

  <article class="{{ $class }}" 
      {{ if $is_sub_event }} itemprop="subEvent" {{ end }}
      {{ if $is_sup_event }} itemprop="superEvent" {{ end }}
      itemscope itemtype="https://schema.org/Event">
    <div class="event-content">
      {{- $title := partial "PrepareHTML" .Title -}}
      {{ if and $options.subtitle .Params.subtitle }}
        <hgroup>
      {{ end }}
      {{ $heading_tag.open }}
        <a href="{{ .Permalink }}" title="{{ safeHTML (i18n "commons.more_aria" (dict "Title" $title)) }}">{{ $title }}</a>
      {{ $heading_tag.close }}
      {{ if and $options.subtitle .Params.subtitle }}
          <p class="event-subtitle">{{ partial "PrepareText" .Params.subtitle }}</p>
        </hgroup>
      {{ end }}

      {{ if eq $layout "agenda" }}
        {{ with .Params.current_time_slot }}
          {{ partial "events/partials/event/hours.html" . }}
        {{ end }}
      {{ end }}

      {{ if $options.dates }}
        {{ partial "events/partials/event/schedule.html" (dict 
            "dates" .Params.dates
            "on_two_lines" (ne $layout "list")
          )}}
      {{ else }}
        {{ with .Params.dates }}
          <meta itemprop="startDate" content="{{- if .from.day -}}{{ .from.day }}{{- end -}}{{- if .from.hour -}}T{{ .from.hour }}{{- end -}}">
          <meta itemprop="endDate" content="{{- if .to.day -}}{{ .to.day }}{{- end -}}{{- if .to.hour -}}T{{ .to.hour }}{{- end -}}">
        {{ end }}
      {{ end }}

      {{ if and $dates.status $options.status }}
        {{ partial "events/partials/event/status.html" $dates.status }}
      {{ end }}

      {{ if and $options.summary .Params.summary }}
        <div class="event-description" itemprop="description">
          {{ partial "GetRichSummary" ( dict 
            "summary" .Params.summary
            "kind" "events"
          )}}
          {{ if eq $layout "large" }}
            <p class="more meta" aria-hidden="true">{{- i18n "commons.more" -}}</p>
          {{ end }}
        </div>
      {{ end }}

      {{ if $options.categories }}
        {{ partial "commons/categories" ( dict
          "context" .
          "kind" "event"
        )}}
      {{- end -}}

      {{ if $with_more }}
        {{ partial "commons/item/more.html" . }}
      {{- end -}}
    </div>
    <div class="media">
      {{- if and $options.image .Params.image -}}
        {{ $sizes := index site.Params.image_sizes.blocks.events $layout }}
        {{- partial "commons/image.html"
            (dict
              "image"    .Params.image
              "sizes"    $sizes
            ) -}}
      {{- else -}}
        {{- partial "commons/image-default.html" "events" -}}
      {{- end -}}
    </div>
  </article>
{{ end }}