{{ $layout := .layout }}
{{ $options := .options }}
{{ $agenda := .agenda }}
{{ $is_sub_event := .is_sub_event }}

<ul class="events events--{{-  $layout -}}">
  {{ range $agenda }}
    <li class="events-date">
      {{ if eq $layout "agenda" }}
        <h2 class="events-date-title" id="{{ anchorize .Key }}"><span>{{ .Key | strings.FirstUpper | safeHTML }}</span></h2>
      {{ end }}
      <ol class="events-scheduled">
        {{ range .Pages }}
        <li>
          {{ partial "events/partials/event.html" (dict
              "event" .
              "layout" $layout
              "options" site.Params.events.index.options
              "is_sub_event" $is_sub_event
            )}}

          {{ with .Params.children_for_the_day }}
            <ol class="event-children">
              {{ range $index, $children := . }}
                {{ with (site.GetPage .path) }}
                  <li>
                    {{ partial "events/partials/event.html" (dict
                      "event" .
                      "layout" $layout
                      "options" $options
                      "is_sub_event" true
                    )}}
                  </li>
                {{ end }}
              {{ end }}
            </ol>
          {{ end }}
        </li>
        {{ end }}
      </ol>
    </li>
  {{ end }}
</ul>
