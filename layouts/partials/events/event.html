{{ $event := .event }}
{{ $layout := .layout | default "list" }}
{{ $heading := .heading | default "h2" }}
{{ $heading_tag := (dict 
    "open" ((printf "<%s itemprop='name' class='event-title'>" $heading) | safeHTML)
    "close" ((printf "</%s>" $heading) | safeHTML)
    ) }}
{{ $index := .index }}
{{ $alternate := .alternate }}
{{ $show_summary := .show_summary }}
{{ $show_category := .show_category }}
{{ $show_status := .show_status }}

{{ with $event }}
  <article class="event {{ if .Params.image }}event--with-image{{ end -}}" itemscope itemtype="https://schema.org/Event">
    <div class="event-content">
      {{- $title := partial "PrepareHTML" .Title -}}
      {{ if .Params.subtitle }}
        <hgroup>
      {{ end }}
      {{ $heading_tag.open }}
        <a href="{{ .Permalink }}" title="{{ safeHTML (i18n "commons.more_aria" (dict "Title" $title)) }}">{{ $title }}</a>
      {{ $heading_tag.close }}
      {{ if .Params.subtitle }}
          <p class="event-subtitle">{{ .Params.subtitle }}</p>
        </hgroup>
      {{ end }}

      {{ if (or .Params.dates.computed.two_lines.short .Params.dates.from.hour .Params.dates.to.hour) }}
        <div class="event-dates" itemprop="startDate" content="{{- if .Params.dates.from.day -}}{{ .Params.dates.from.day }}{{- end -}}{{- if .Params.dates.from.hour -}}T{{ .Params.dates.from.hour }}{{- end -}}">
          <span>{{ partial "PrepareHTML" .Params.dates.computed.two_lines.short }}</span>
          {{- if (or .Params.dates.from.hour .Params.dates.to.hour) }}
            <div class="event-time">
              {{- if .Params.dates.from.hour }}
                <span>{{ .Params.dates.from.hour }}</span>
              {{ end -}}
              {{- if .Params.dates.to.hour }}
                <span> {{ .Params.dates.to.hour }}</span>
              {{ end -}}
            </div>
          {{ end -}}
        </div>
      {{ end }}
      {{ if and .Params.events_categories $show_status }}
        <p class="event-status">
          {{ if eq .Params.dates.status "current"}}
            {{- i18n "blocks.events.current" -}}
          {{ else if .Params.dates.status "future" }}
            {{- i18n "blocks.events.future" -}}
          {{ else if .Params.dates.status "archive" }}
              {{- i18n "blocks.events.archive" -}}
          {{ end }}
        </p>
      {{ end }}

      {{ if and (site.Params.events.index.show_description) ($show_summary) }}
        {{- if (partial "GetTextFromHTML" .Params.summary) -}}
          <div class="event-description">
            <p itemprop="description">
              {{ if site.Params.events.index.truncate_description }}
                {{ partial "GetTruncateContent" ( dict 
                  "text" .Params.summary
                  "length" site.Params.events.index.truncate_description
                  ) }}
              {{ else }}
                {{ partial "PrepareText" .Params.summary }}
              {{ end }}
            </p>
          </div>
        {{- end -}}
        
        {{ if and .Params.events_categories $show_category }}
          <p class="event-categories">
            {{- range $index, $category := .GetTerms "events_categories" -}}
              <span>{{- $category.Title -}}</span>
            {{- end -}}
          </p>
        {{ end }}
      {{- end -}}

      {{ if eq $layout "large" }}
        <p class="more meta" aria-hidden="true">{{- i18n "commons.more" -}}</p>
      {{ end }}
    </div>
    <div class="media">
      {{ $event_image := "" }}
      {{- if .Params.image -}}
        {{ $event_image = .Params.image }}
        {{- else if site.Params.events.default_image -}}
        {{ $event_image = site.Data.website.default_image }}
      {{ end }}
      
      {{- if or .Params.image site.Params.events.default_image -}}
        {{- partial "commons/image.html"
              (dict
                "image"    $event_image
                "sizes"    site.Params.image_sizes.sections.events.item
              ) -}}
      {{- end -}}
    </div>
  </article>
{{ end }}