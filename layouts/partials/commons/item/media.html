{{ $image := .image }}
{{ $type := .type | default "page" }}
{{ $layout := .layout | default "item" }}
{{ $sizes := site.Params.image_sizes.sections.pages.item }}
{{ $class := "media" }}
{{ with .class }}
  {{ $class = printf "%s %s" $class . }}
{{ end }}

{{ with index site.Params.image_sizes.sections $type }}
{{ with index . $layout }}
    {{ $sizes = . }}
  {{ end }}
{{ end }}

{{ if .sizes }}
  {{ $sizes = .sizes }}
{{ end }}

<div class="{{ $class }}">
  {{- if $image -}}
    {{- partial "commons/image.html" (dict
        "image" $image
        "sizes" $sizes
      ) -}}
  {{- else -}}
    {{- partial "commons/image-default.html" $type -}}
  {{- end -}}
</div>