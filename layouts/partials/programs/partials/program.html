{{ $program := .program }}
{{ $heading := .heading | default "h2" }}
{{ $heading_tag := (dict 
  "open" ((printf "<%s class='program-title' itemprop='name'>" $heading) | safeHTML)
  "close" ((printf "</%s>" $heading) | safeHTML)
  ) }}
{{ $layout := .layout }}
{{ $options := .options }}
{{ $sizes := cond (eq $layout "list") site.Params.image_sizes.blocks.programs.list "" }}

<li class="program" itemscope itemtype="https://schema.org/EducationalOccupationalCredential">
  <div class="program-content">
    {{ $title := partial "PrepareHTML" $program.Title }}
    {{ $heading_tag.open }}
      <a href="{{ $program.Permalink }}" itemprop="url" title="{{ safeHTML (i18n "commons.more_aria" (dict "Title" $title)) }}">
        {{ $title }}
      </a>
    {{ $heading_tag.close }}

    {{/*  TODO: remove when option is added to the block  */}}
    {{ if or site.Params.programs.index.options.categories $options.categories }}
      {{ partial "commons/categories.html" ( dict
        "context" $program
        "kind" "program"
      )}}
    {{ end }}

    {{ $diploma := $program.Params.diplomas }}
    {{ if and $options.diploma $diploma }}
      {{- $diploma = site.GetPage (printf "/diplomas/%s" $diploma) -}}
      {{- with $diploma -}}
        <span class="program-diploma">{{ partial "PrepareHTML" .Params.short_name }}</span>
      {{- end -}}
    {{ end }}

    {{ if and $options.summary $program.Params.summary }}
      <div itemprop="abstract">
        {{ partial "GetRichSummary" ( dict 
          "summary" $program.Params.summary
          "kind" "programs"
        )}}
      </div>
    {{ end }}

    {{ if $options.button }}
      <p class="btn">{{ i18n "commons.more" }}</p>
    {{ end }}

    {{ if and $options.logo $program.Params.logo }}
      {{ partial "commons/image.html"
        (dict
          "image" $program.Params.logo
          "lazy" false
          "html_class" "program-logo"
        ) }}
    {{ end }}
  </div>

  {{ if and $options.contact $program.Params.roles }}
    {{ $first_role := index $program.Params.roles 0 }}
    {{ $person := index $first_role.persons 0 }}
    {{ $person = site.GetPage (printf "/persons/%s" $person) }}
    <div class="program-contact meta">
      <span class="program-contact-title">{{ $first_role.title }}</span>
      {{ with $person }}
        <span>
          {{ .Title }} â€” 
          {{ with or .Params.contact_details.phone .Params.contact_details.phone_professional }}
            <a href="{{ chomp .value }}">{{ .label }}</a>
          {{ end }}
          {{ with .Params.contact_details.email }}
            <a href="{{ chomp .value }}">{{ .label }}</a>
          {{ end }}
        </span>
      {{ end }}
    </div>
  {{ end }}
  {{ if and $program.Params.image $options.image }}
    {{ partial "programs/partials/program/media.html" (dict 
        "image" $program.Params.image
        "layout" $layout
        "sizes" $sizes
      ) }}
  {{ end }}
</li>
