{{ $publications := partial "FilterPublications" .Pages }}
{{ $paginator := .Paginate $publications }}

<div class="">
  {{ if site.Params.publications.index.group_by_year }}
    {{ $publications_by_years := .Paginator.Pages.GroupByDate "2006" }}
    {{ range $publications_by_years }}
      <section>
        <h2 class="publications-year">{{ .Key }}</h2>
        <ul class="publications">
          {{ range .Pages }}
            {{ partial "publications/partials/publication.html" (dict "publication" . ) }}
          {{ end }}
        </ul>
      </section>
    {{ end }}
  {{ else }}
    <ul class="publications">
      {{ range .Paginator.Pages }}
        {{ partial "publications/partials/publication.html" (dict "publication" . ) }}
      {{ end }}
    </ul>
  {{ end }}
</div>