<style>
  .img-debug {
    font-size: 1.1rem; 
    line-height: 1.2;
    padding: 10px;
    background-color: white;
    color: black;
    display: block;
    position: absolute;
    bottom: 0;
    left: 0;
    text-align: left !important;
    font-family: sans-serif;
    white-space: nowrap;
    opacity: 0.9;
  }
  .img-debug small {
    font-size: 0.9rem; 
    font-family: sans-serif;
    display: none;
  }
  .img-debug:hover small {
    display: block;
  }
  .img-debug.is-bad {
    background: tomato;
    color: black;
  }
</style>

<script>
  window.addEventListener('keydown', e => {
    if (e.ctrlKey && e.key === 'i') {
      showImageDimension();
    }
  });
  document.querySelectorAll('img').forEach(img => {
    img.addEventListener('click', e => {
      if (e.altKey) {
        e.preventDefault()
        e.stopImmediatePropagation()
        responsiveImageDebugOutput(img)
      }
    })
  })
  function showImageDimension() {
    document.querySelectorAll('img').forEach(img => {
      const listener = function () {
        // Return if svg
        if (img.src.split('.')[1] === 'svg') return;

        const threshold = 0.2, // 20% of tolerance
          parent = img.parentElement,
          pixelRatio = Math.round(window.devicePixelRatio * 10) / 10,
          dimensions = {
            width: Math.round(img.naturalWidth * pixelRatio),
            height: Math.round(img.naturalHeight * pixelRatio)
          },
          target = {
            width: Math.round(img.width * window.devicePixelRatio),
            height: Math.round(img.height * window.devicePixelRatio)
          },
          essential = 
`<b>Ratio</b> : ${pixelRatio}<br>
<b>Loaded</b> : ${dimensions.width}x${dimensions.height}<br>
<b>Needed</b> : ${target.width}x${target.height}<br>
<b>Ideal config</b> : ${img.width}x${img.height}`
          result =`
  Rendered size: ${img.width}x${img.height}
  Intrinsic size: ${dimensions.width}x${dimensions.height}
  Device Pixel ratio: ${window.devicePixelRatio}`,
          p = parent.querySelector('.img-debug') || document.createElement('p'),
          small = document.createElement('small');
        
        small.innerText = result;
        p.innerHTML = essential
        p.append(small);
        p.classList.add('img-debug');
        const ratio = getImageWidthRatio(dimensions, target);
        if (ratio > threshold) {
          p.classList.add('is-bad');
        } else {
          p.classList.remove('is-bad');
        }

        const debug = img.querySelector('.img-debug');
        if (debug) parent.removeChild();

        parent.append(p);
        parent.style.position = 'relative';
      };

      if (img.complete) listener();
      img.addEventListener('load', listener);
      window.addEventListener('resize', listener);
    });
  }
  function getImageWidthRatio(source, target) {
    return Math.abs((source.width - target.width) / Math.max(source.width, target.width));
  }
  function getImageRatio(source, target) {
    const widthRatio = Math.abs((source.width - target.width) / Math.max(source.width, target.width)),
      heightRatio = Math.abs((source.height - target.height) / Math.max(source.height, target.height));

    return (widthRatio + heightRatio) / 2;
  }
</script>